#textdomain wesnoth-Fall_of_Silvium
# SCENARIO 2: The Raid (891 SI, January)
# Caius reaches the capital and finds it under attack by Marauders. On defeating the attackers, more Marauders arrive and Caius is forced to defend the city while organising a retreat of the civilian population. Caius' centurion remains behind to buy time.

[scenario]
    name= _ "Siege of Silvium"
    id=2_Siege_of_Silvium
    turns=30
    map_data="{~add-ons/Fall_of_Silvium/maps/2_Siege_of_Silvium.map}"
    next_scenario=3_Down_the_Silvia_River
    victory_when_enemies_defeated=no
    {DEFAULT_MUSIC_PLAYLIST}
	{DEFAULT_SCHEDULE_DAWN}
	# recruits loyals and makes death events happen
    {FOS_DEATHS}   

    # good guys are back
    [side]
        side=1
        controller=human
        team_name=good
        user_team_name= _ "12th Legion"
        {GOLD 180 150 120}
		type=IE_Lavinian_Tribune
        id=CaiusR
    [/side]
    
    # these guys come at the end but they're team 2 all campaign
    [side]
        side=2
        controller=ai
        color=white
        recruit=IE_Marauder_Warrior,IE_Marauder_Scout,IE_Marauder_Crusher,IE_Marauder_Axeman,IE_Marauder_Boatsman
        team_name=bad
        user_team_name= _ "Wylflings"
        {GOLD 200 250 300}
        {INCOME 5 8 10}
        [ai]
            recruitment_pattern=fighter,fighter,fighter,scout
            aggression=0.8
            caution=0.2
        [/ai]
        no_leader=yes
    [/side]
    
    # good guys have friends
    [side]
        side=3
        controller=ai
        color=orange
        team_name=good
        user_team_name= _ "12th Legion"
        recruit=IE_Lavinian_Legionnaire,IE_Lavinian_Bowman,IE_Lavinian_Auxiliary
        {GOLD 100 80 60}
        type=IE_Lavinian_Centurion
        id=SenturusA
        name= _ "Senturus Applius"
        canrecruit=yes
    [/side]

    # there are baddies
    [side]
        side=4
        controller=ai
        color=blue
        recruit=IE_Marauder_Warrior,IE_Marauder_Scout,IE_Marauder_Crusher,IE_Marauder_Axeman,IE_Marauder_Boatsman
        team_name=bad
        user_team_name= _ "Wylflings"
        {GOLD 200 250 300}
        {INCOME 5 6 7}
        type=IE_Marauder_Thain
        id=BjornwylfW
        name= _ "Bjornwylf Wyrmwylfsson"
        canrecruit=yes
        [ai]
            recruitment_pattern=fighter,fighter,fighter,scout
            aggression=0.6
            caution=0.4
        [/ai]
    [/side]
    
    # their friends are late
    [side]
        side=5
        controller=ai
        color=green
        recruit=IE_Marauder_Warrior,IE_Marauder_Scout,IE_Marauder_Crusher,IE_Marauder_Axeman,IE_Marauder_Boatsman
        team_name=bad
        user_team_name= _ "Wylflings"
        {GOLD 150 200 250}
        {INCOME 6 8 10}
        [ai]
            recruitment_pattern=fighter,fighter,fighter,scout
            aggression=0.8
            caution=0.2
        [/ai]
    [/side]
    
    # storytime last updated 2012
    [story]
        [if]
            [variable]
                name=wordytext
                boolean_equals=yes
            [/variable]
            [then]
                [part]
                    story= _ "Marauder attacks are not a rare occurrence on the borders of Silvia even in times of peace, as leading a warband is something of a rite of passage for a young Thain and the fertile lands of Silvia make for a tempting target. Even so, that there had been repeated attacks in a short time was concerning, and the lack of communication from my centurion in the capital even more so."
                    {NON_STRETCHED_IMAGE 100 100 story/2_3_Silvium.png}
                [/part]
                [part]
                    story= _ "Were there more Marauder attacks planned? Perhaps an organised attack on all of Silvia? For that to happen, some kind of significant change in the power balance amongst the clan must have occurred, an event that our agents amongst the Marauders worked constantly to avoid. Such a leader could wipe us from the north, the sheer numbers of the Marauder clans overwhelming the disciple of the legions."
                    {NON_STRETCHED_IMAGE 100 100 story/2_3_Silvium.png}
                [/part]
                [part]
                    story= _ "These fears swam through my mind as we came over the last hill and the city of Silvium lay before us..."
                    {NON_STRETCHED_IMAGE 100 100 story/2_3_Silvium.png}
                [/part]
            [/then]
        [/if]
        [part]
            background=maps/lavinium.png
            show_title=yes
            {OLD_JOURNEY 360 292}
            {OLD_JOURNEY 340 260}
            {OLD_JOURNEY 328 224}
            {OLD_JOURNEY 325 187}
            {OLD_JOURNEY 338 159}
            {OLD_JOURNEY 307 145}
            {OLD_BATTLE 292 122}
            {NEW_BATTLE 307 98}
        [/part]
    [/story] 
        
    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Defend Silvium from the attacking Marauders (1/4)"
                condition=win
            [/objective]
            # [objective]
                # description= _ "Kill the Marauder Thain (2/4)"
                # condition=win
            # [/objective]
            # [objective]
                # description= _ "Defend Silvium for two days (3/4)"
                # condition=win
            # [/objective]
            # [objective]
                # description= _ "Move all civilians to the signpost (4/4)"
                # condition=win
            # [/objective]
            [objective]
                description= _ "Death of Caius Regilius (1/5)"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Senturus Applius (2/5)"
                condition=lose
            [/objective]
            [objective]
                description= _ "Marauders sack a village within Silvium (3/5)"
                condition=lose
            [/objective]
			[objective]
                description= _ "Run out of time (4/5)"
                condition=lose
            [/objective]
            # [objective]
                # description= _ "Death of a Lavinian Nobleman (5/5)"
                # condition=lose
            # [/objective]
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
        
        [label]
            text= _ "Silvium"
            x,y=15,26
        [/label]
        [label]
            text= _ "To Pass of Arendia"
            x,y=5,32
        [/label]
        [label]
            text= _ "To Portum Frigae"
            x,y=26,27
        [/label]
        [label]
            text= _ "To Silvian Plains"
            x,y=23,32
        [/label]
        [label]
            text= _ "Silvia River"
            x,y=21,20
        [/label] 
    
        # variables for Jugarthus and Septus' bet
        {VARIABLE JMkills 0}
        {VARIABLE STkills 0}

        # variable for timed events since first maruader leader kill
        {VARIABLE turns 0}
    
        # variables for time until chaser arrives
        {VARIABLE chasercount 0}
        {FOS_CHASERNAME}
		
		# include macro for civilian escape
        {FOS_ESCAPE}
    [/event]
    
	# the ai control most of the villages already
    {STARTING_VILLAGES 3 10}
    {STARTING_VILLAGES 4 13}
	
    [event]
        name=start
        
        # the marauders and allied lavinians have units already fighting in the outskirts of the city...
        [unit]
            side=3
            type=IE_Lavinian_Legionnaire
            x,y=12,20
            generate_name=yes
        [/unit]
        [unit]
            side=3
            type=IE_Lavinian_Bowman
            x,y=15,19
            generate_name=yes
        [/unit]
        [unit]
            side=3
            type=IE_Lavinian_Auxiliary
            x,y=14,17
            generate_name=yes
        [/unit]
        [unit]
            side=3
            type=IE_Lavinian_Legionnaire
            x,y=18,17
            generate_name=yes
        [/unit]
        [unit]
            side=3
            type=IE_Lavinian_Bowman
            x,y=11,24
            generate_name=yes
            id=unitone
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Warrior
            x,y=18,16
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Warrior
            x,y=10,20
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Axeman
            x,y=15,17
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Axeman
            x,y=16,18
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Scout
            x,y=14,16
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Boatsman
            x,y=11,19
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Boatsman
            x,y=12,17
            generate_name=yes
        [/unit]
        
        # the ones that are already fighting are injured...
		## this is the old [i] format but still seems to work, consider replacing with similar format to the civilian store sometime
        [store_unit]
            [filter]
                [not]
                    canrecruit=yes
                [/not]
                [not]
                    side=1
                [/not]
            [/filter]
            variable=temp
            kill=yes
        [/store_unit]
        {FOREACH temp i}
        {RANDOM -20..0,-10..0}
        [set_variable]
            name=temp[$i].hitpoints
            add=$random
        [/set_variable]
        {RANDOM 2..24,2..10}
        [set_variable]
            name=temp[$i].experience
            add=$random
        [/set_variable]
        [unstore_unit]
            variable=temp[$i]
        [/unstore_unit]
        {NEXT i}
        [clear_variable]
            name=temp
        [/clear_variable]
        
        # ...those just recruited are not
        [unit]
            side=3
            type=IE_Lavinian_Legionnaire
            x,y=16,24
            generate_name=yes
        [/unit]
        [unit]
            side=3
            type=IE_Lavinian_Bowman
            x,y=15,27
            generate_name=yes
        [/unit]
        [unit]
            side=3
            type=IE_Lavinian_Auxiliary
            x,y=15,25
            generate_name=yes
        [/unit]
        [unit]
            side=3
            type=IE_Lavinian_Auxiliary
            x,y=13,28
            generate_name=yes
            id=unittwo
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Boatsman
            x,y=6,7
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Boatsman
            x,y=5,9
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Warrior
            x,y=9,13
            generate_name=yes
        [/unit]
        [unit]
            side=4
            type=IE_Marauder_Scout
            x,y=8,8
            generate_name=yes
        [/unit]
        
        # a wild discussion appears!
        {TALKWORDY unitone CaiusR _"More marauders approaching from the South, sir!"}
        {TALKWORDY unittwo CaiusR _"More? We're surrounded!"}
        {TALKWORDY SenturusA CaiusR _"Calm yourselves! Those are our own banners. Caius Regilius has returned!"}
        {TALKWORDY SeptusT CaiusR _"And just in the nick of time, by the look of it"}
        {TALKWORDY CaiusR CaiusR _"Men of the Twelfth Legion! Take heart, your tribune is here! We have been given a sacred trust by the Imperator himself to defend this city, and defend it we will! No marauder shall set foot inside it while I defend it."}
        {TALKWORDY CaiusR CaiusR _"You, Thain, take heed. The city is walled and the legion stands ready to meet you. You will not prevail here. Go home to your own lands."}
        {TALK BjornwylfW _"I do not know how you managed to slip by my brother, Tribune, but you will die here like every other that opposes us. This land and its people will belong to the Wylflings and to our children after us."}
        {TALK SeptimusA _"It seems there is no reasoning with him. Let us teach him to fear the name of Lavinia."}
        {TALKWORDY CaiusR CaiusR _"I wonder at the cause of the desperation that could drive him to such a rash measure..."}
        {TALKWORDY JugarthusM CaiusR _"Does it matter? We must drive them off. The walls of this city do not look as strong as you boast."}
        {TALKWORDY AppiusS JugarthusM _"Indeed, though I think the tribune had hoped that they may look it to a marauder from the fens..."}
        {TALK CaiusR _"Very well, it has come to this. Our orders from the Emperor himself, and he will not suffer failure. Protect the city, let no Marauders in. Throw them back! Twelfth Legion, march!"}
        {TALKWORDY JugarthusM SeptusT _"This might be interesting after all."}
        {TALKWORDY JugarthusM SeptusT _"Are you up for a challenge, little man? If I bag more Marauder heads than you, will you give me your cloak?"}
        {TALKWORDY SeptusT JugarthusM _"Not going to happen. When I win, you're buying all the boys a drink!"}
    [/event]

    # a conversation with the centurion occurs when you enter the citadel
    [event]
        name=moveto
        [filter]
            id=CaiusR
            x=14-16
            y=24-27
        [/filter]
        {TALKWORDY CaiusR CaiusR _"Report, centurion."}
        {TALK SenturusA _"Sir. I've never seen anything like it. Marauder raids are never this regular or this intense. Something is very wrong here."}
        {TALKWORDY CaiusR CaiusR _"I agree, but I doubt that the situation will improve if we kill this thain."}
        {TALKWORDY SenturusA CaiusR _"If these hordes keep on coming, what choice do we have?"}
        {TALKWORDY CaiusR CaiusR _"Truly, none at all. The Imperator would have us hold Silvia if it kills every one of us."}
        {TALKWORDY SenturusA CaiusR _"If the Imperator commands it, you will not find the Twelfth wanting, sir."}
    [/event]
    
    # more marauders arrive when you get close to the thain
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x=1-12
            y=1-12
        [/filter]
        [event]
            name=side turn
            [gold]
                side=4
#ifdef EASY
                amount=60
#endif
#ifdef NORMAL
                amount=80
#endif
#ifdef HARD
                amount=100
#endif    
            [/gold]
        
            # spawn scouts from the second leader on the edge of the map
            [unit]
                side=5
                type=IE_Marauder_Scout
                x,y=26,5
                generate_name=yes
            [/unit]
            {MOVE_UNIT_FAKE 26 5    24 4    24 3}
            [unit]
                side=5
                type=IE_Marauder_Scout
                x,y=26,10
                generate_name=yes
            [/unit]
            {MOVE_UNIT_FAKE 26 10   25 11    25 11}
            [unit]
                side=5
                type=IE_Marauder_Mounted_Axeman
                x,y=26,8
                generate_name=yes
                id=byrnscout
            [/unit]
            {MOVE_UNIT_FAKE 26 8    23 7    23 7}
            {TALK SeptimusA _"More of the beggars sighted to the North East, Tribune."}
            {TALKWORDY byrnscout CaiusR _"Ho, you still haven't burnt this place to the ground, Bjornwylf? Don't worry, Ranwylf will be along soon enough to help you out!"}
            {TALKWORDY BjornwylfW CaiusR _"Hah! By the time that slow-coach of a cousin of mine gets here, I'll have crushed these Lavinian bugs! Reserves, forward!"}
            {TALKWORDY CaiusR CaiusR _"Young man. How has Lavinia wounded you to cause this madness?"}
            {TALKWORDY BjornwylfW CaiusR _"Our reasons are our own, Lavinian. The plight of the Wylfs is not your concern!"}
            {TALKWORDY CaiusR CaiusR _"You could have a long life ahead of you, do not make me end it. Many have died here, and countless more will die before I allow this city to fall. Will you not call off this bloodbath?"}
            {TALKWORDY BjornwylfW CaiusR _"No! I cannot. My cousin will be here soon, and together we will crush you. We must, for the honour of the Wylfs!"}
            {TALKWORDY AppiusS CaiusR _"It seems he won't back down, and there's more of them on the way. What do we do, sir? We can barely fight THIS lot!"}
            {TALK CaiusR _"If there are even more Marauders on their way, then it seems that any hope I had of avoiding a war may have been in vain, and some grand plot is already set in motion. For now, we must finish this foolish Thain off, and make sure to keep a garrison at the bridge-head to stop those scouts reaching the city."}
            {TALKWORDY SeptusT CaiusR _"Finish him off? With pleasure, Sir!"}
            {TALKWORDY JugarthusM SeptusT _"Ha! Not if I get to him first, little man!"}
            {TALKWORDY CaiusR CaiusR _"Get to work, all of you. This promises to be no easy battle."}

            # objectives update
            [objectives]
                side=1
                [objective]
                    description= _ "Defend Silvium from the attacking Marauders (1/4)"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Kill the Marauder Thain (2/4)"
                    condition=win
                [/objective]
                # [objective]
                    # description= _ "Defend Silvium for two days (3/4)"
                    # condition=win
                # [/objective]
                # [objective]
                    # description= _ "Move all civilians to the signpost (4/4)"
                    # condition=win
                # [/objective]
                [objective]
                    description= _ "Death of Caius Regilius (1/5)"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Senturus Applius (2/5)"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Marauders sack a village within Silvium (3/5)"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Run out of time (4/5)"
                    condition=lose
                [/objective]
                # [objective]
                    # description= _ "Death of a Lavinian Nobleman (4/5)"
                    # condition=lose
                # [/objective]
                [gold_carryover]
                    bonus=yes
                    carryover_percentage=40
                [/gold_carryover]
            [/objectives]
        [/event]
    [/event]

    # when you kill the thain, the scenario changes
    [event]
        name=last breath
        [filter]
            id=BjornwylfW
        [/filter]
        {TALK BjornwylfW _"So, I have failed... but you, too, shall perish..."}
    [/event]
    [event]
        name=die
        [filter]
            id=BjornwylfW
        [/filter]    
        {TALKWORDY SeptusT CaiusR _"Confident little blighter, wasn't he?"}
    
        # a second thain arrives (and some bodyguards as well)
        ## at some point, I'd like to insert a check to make sure the player has no near units and move the spawn point and keep if they do
        ## also, maybe make them move in rather than appear?
        [unit]
            side=5
            type=IE_Marauder_Thain
            canrecruit=yes
            id=RanwylfC
            name= _ "Ranwylf CarmWylfsson"
            x,y=24,6
        [/unit]
        [unit]
            side=5
            type=IE_Marauder_Pillager
            x,y=23,5
            generate_name=yes
        [/unit]
        [unit]
            side=5
            type=IE_Marauder_Raider
            x,y=24,7
            generate_name=yes
        [/unit]
        [unit]
            side=5
            type=IE_Marauder_Woodsman
            x,y=25,5
            generate_name=yes
        [/unit]
        [terrain]
            x=23,23,24,24,25,25,23,24,25
            y=6,7,5,7,6,7,5,4,5
            terrain=Ce
        [/terrain]
        [terrain]
            x,y=24,5
            terrain=Ke
        [/terrain]

        
        # the lavinians are alarmed about this
        {TALKWORDY AppiusS CaiusR _"More Marauders sighted, Tribune!"}
        {TALK RanwylfC _"Hoho! Cousin Byrnwylf bit the dust, hey? All the more glory for me when we burn this place down, then!"}
    
        # ranwylf gets bjornwylf's remaining dudes
        [capture_village]
            owner_side=4
            side=5
        [/capture_village]
        [if]
            [have_unit]
                side=4
            [/have_unit]
            [then]
            {TALKWORDY RanwylfC CaiusR _"You men. If you are loyal Wylflings, you will follow me now!"}
                [modify_unit]
                    [filter]
                        side=4
                    [/filter]
                    side=5
                [/modify_unit]
            [/then]
        [/if]
        
        # caius offers peace
        {TALKWORDY CaiusR CaiusR _"Young Thain. I regret being forced to kill your cousin. Will you not treat with us here and avoid more blooshed?"}
        {TALKWORDY RanwylfC CaiusR _"Cease your yapping, dog! The Wylfs do not bow before any man. Prepare your soul for whatever afterlife you filth generally rot in."}
    
        # i try in vain to convince the player to play defence
        {TALKWORDY SenturusA CaiusR _"It is as we feared, then, they just keep coming"}
        {TALKWORDY SeptusT JugarthusM _"No matter...Let me at them!"}
        {TALKWORDY SeptimusA SeptusT _"Be careful, Septus. I need you alive."}
        {TALKWORDY SeptusT SeptimusA _"Septimus, I had no idea that you cared so much"}
        {TALKWORDY SeptimusA SeptusT _"Of course I do. If you're dead, how will you win me a beer off of the Nemidian? I could do with a drink about now."}
        {TALK CaiusR _"Legion, hold together and fall back. We cannot dismiss the possibility that there are more of these Marauders on the way, so we cannot leave any entrance to the city undefended. The emperor has charged me to ensure that the citizens of the capital are protected. No Marauder must be allowed into Silvium."}
        
        # gives more turns to complete scenario
        [modify_turns]
            add=12
        [/modify_turns]
        
        # objectives update
        [objectives]
            side=1
            [objective]
                description= _ "Defend Silvium from the attacking Marauders (1/4)"
                condition=win
            [/objective]
            # [objective]
                # description= _ "Kill the Marauder Thain (2/4)"
                # condition=win
            # [/objective]
            [objective]
                description= _ "Defend Silvium for two days (3/4)"
                condition=win
            [/objective]
            # [objective]
                # description= _ "Move all civilians to the signpost (4/4)"
                # condition=win
            # [/objective]
            [objective]
                description= _ "Death of Caius Regilius (1/5)"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Senturus Applius (2/5)"
                condition=lose
            [/objective]
            [objective]
                description= _ "Marauders sack a village within Silvium (3/5)"
                condition=lose
            [/objective]
            [objective]
                description= _ "Run out of time (4/5)"
                condition=lose
            [/objective]
            # [objective]
                # description= _ "Death of a Lavinian Nobleman (5/5)"
                # condition=lose
            # [/objective]
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
        
        [event]
            name=new turn
            first_time_only=no
            
            # increments each turn to count turns for timed events
            [set_variable]
            name=turns
            add=1
            [/set_variable]
            
            # triggers timed event 1 (more scouts)
            [if]
                [variable]
                    name=turns
                    equals=6
                [/variable]
                [then]
                    # Bring on the follower Thain's scout.
                    [move_unit_fake]
                        side=2
                        type=IE_Marauder_Raider
                        x=1,3,5,5,5,5,2,1
                        y=32,30,30,30,30,30,30,32
                    [/move_unit_fake]

                    # Big ole warning for the player so that more marauders won't be a surprise
                    {TALK SenturusA _"Looks like we can expect more company to the South-West soon, Tribune."}
                    {TALKWORDY AppiusS CaiusR _"Sir, we're holding for now, but more of these savages and we'll surely be overrun."}
                    {TALK CaiusR _"No, we cannot hold against yet another warband.  Ready the civilians, we have no choice but to evacuate the city!"}
                    {TALKWORDY AppiusS SeptimusA _"But sir, the Emperor's instructions were..."}    
                    {TALKWORDY SeptimusA AppiusS _"Appius, the Tribune is well aware of the situation. Be quiet and wait for your orders."}
                    {TALK CaiusR _"Legion, we must hold while we gather the citizens. Beat back those in the North and prepare for an attack from the South-West at any time."}
                    {TALKWORDY AppiusS SeptimusA _"Yes, sir!"}    
                    {TALKWORDY CaiusR SenturusA _"Let us just hope we live love enough to receive a reprimand from the Emperor over this disaster."}
                [/then]
            [/if]
            
            # triggers timed event 2 (another Thain)
            [if]
                [variable]
                    name=turns
                    equals=12
                [/variable]
                [then]
                    [unstore_unit]
                        variable=chaser
                        x,y=1,32
                    [/unstore_unit]
                    [clear_variable]
                        name=chaser
                    [/clear_variable]
                    [terrain]
                        x=1,2,2,2,3,3
                        y=31,31,32,30,31,32
                        terrain=Ce
                    [/terrain]
                    [terrain]
                        x,y=1,32
                        terrain=Ke
                    [/terrain]
                    # this bit makes the terrain passable, up to this point it was impassible to prevent leader ganking
                    [terrain]
                        x=1,2,2,2,3,3,1
                        y=31,31,32,30,31,32,32
                        layer=overlay
                        terrain="^"
                    [/terrain]
                    [unit]
                        side=2
                        type=IE_Marauder_Pillager
                        x,y=2,31
                        generate_name=yes
                    [/unit]
                    [unit]
                        side=2
                        type=IE_Marauder_Raider
                        x,y=1,31
                        generate_name=yes
                    [/unit]
                    [unit]
                        side=2
                        type=IE_Marauder_Woodsman
                        x,y=2,32
                        generate_name=yes
                    [/unit]
                    [unit]
                        side=2
                        type=IE_Marauder_Axeman
                        x,y=2,30
                        generate_name=yes
                    [/unit]
                    [unit]
                        side=2
                        type=IE_Marauder_Scout
                        x,y=3,31
                        generate_name=yes
                    [/unit]
                    [unit]
                        side=2
                        type=IE_Marauder_Warrior
                        x,y=3,32
                        generate_name=yes
                    [/unit]
                    
                    # Caius orders the soldiers to hold the line
                    {TALKWORDY SenturusA CaiusR _"More marauders spotted to the South-West, Sir!"}
                    {TALK AldwylfW _"I expected to arrive to greet my brother and watch your hated city burning, Tribune, but instead I find you surrounded by countless Marauder dead. I will make you pay if it's the last thing that I ever do!"}
                    {TALKWORDY AppiusS CaiusR _"That's it, then, we'll have to leave now. The emperor is not going to be happy."}    
                    {TALKWORDY SeptusT Appius _"That's the least of our problems, kid. We still have to fight our way out of this mess."}    
                
                    # Bring out the civilians
                    {NEW_NOBLE 19 26 ("Secundus Dulcitius")}
                    {NEW_NOBLE 20 24 ("Tertius Publicus")}
                    {NEW_NOBLE 17 24 ("Decimus Pedius")}
                    {NEW_NOBLE 11 25 ("Gnaeus Pedius")}
                    {NEW_NOBLE 10 26 ("Lucius Aufidius")}
                    {NEW_NOBLE 13 28 ("Spurius Accius")}
                    {NEW_NOBLE 16 27 ("Corvus Corvus")}
                    
                    # more turns to get noblemen out
                    [modify_turns]
                        add=12
                    [/modify_turns]
                    
                    # Caius tells them what to do
                    {TALKWORDY SenturusA CaiusR _"The civilians are ready to travel, sir."}                    
                    {TALK CaiusR _"It has come to this, then. Legion, hold back the marauders as best you can while we extract the civilians. We'll be travelling East."}
                    {TALK SenturusA _"It's been an hour, Tribune. My men and I will hold the city as long as we can to buy you some time."}
                    {TALKWORDY AppiusS SeptimusA _"What? We're not just going to leave you behind!"}    
                    {TALKWORDY SeptimusA AppiusS _"He's a soldier of the Lavinian Empire, Appius. He knows how to do his duty. Learn from him and maybe you'll live to do yours another day."}

                    # allies get more gold for units just in case the player is over-stretched.
                    [gold]
                        side=3
                        amount=60
                    [/gold]
                    {HIGHLIGHT_IMAGE 26 27 scenery/signpost.png ()}
    
                    # update objectives for the last time
                    [objectives]
                        side=1
                        # [objective]
                            # description= _ "Defend Silvium from the attacking Marauders (1/4)"
                            # condition=win
                        # [/objective]
                        # [objective]
                            # description= _ "Kill the Marauder Thain (2/4)"
                            # condition=win
                        # [/objective]
                        # [objective]
                            # description= _ "Defend Silvium for three days (3/4)"
                            # condition=win
                        # [/objective]
                        [objective]
                            description= _ "Move all Noblemen to the signpost (4/4)"
                            condition=win
                        [/objective]
                        [objective]
                            description= _ "Death of Caius Regilius (1/5)"
                            condition=lose
                        [/objective]
                        # [objective]
                            # description= _ "Death of Senturus Applius (2/5)"
                            # condition=lose
                        # [/objective]
                        # [objective]
                            # description= _ "Marauders sack a village within Silvium (3/5)"
                            # condition=lose
                        # [/objective]
						[objective]
                            description= _ "Run out of time (4/5)"
                            condition=lose
                        [/objective]
                        [objective]
                            description= _ "Death of a Lavinian Nobleman (5/5)"
                            condition=lose
                        [/objective]
                        [gold_carryover]
                            bonus=yes
                            carryover_percentage=40
                        [/gold_carryover]
                    [/objectives]
                [/then]
            [/if]
        [/event]
    [/event]
    
    # When civilians get to the signpost, they can leave
    [event]
        name=moveto
        first_time_only=no
        [filter]
            x,y=26,27
            type=IE_Lavinian_Nobleman
        [/filter]
        [set_variable]
            name=rando
            rand=0..8
        [/set_variable]
        [message]
            x,y=26,27
            message=$civescape[$rando].value
        [/message]
        [store_unit]
            [filter]
                x,y=26,27
            [/filter]
            variable=nobles
            kill=yes
            mode=append
        [/store_unit]
        
        # victory stuff goes here somewhere.
        [if]
            [have_unit]
                side=1
                type=IE_Lavinian_Nobleman
            [/have_unit]
            [else]
                [filter_condition]
                    [variable]
                        name=turns
                        more_than=12
                    [/variable]
                [/filter_condition]
                {TALKWORDY AppiusS CaiusR _"The civilians are all on the road East now, sir."}                    
                {TALK CaiusR _"It is time for us to march. I have failed in my duty to hold this city, but I'll not let her people perish while I draw breath."}
                {TALKWORDY SenturusA CaiusR _"Farewell, Tribune. I will hold them off as long as I can."}    
                {TALKWORDY CaiusR SenturusA _"Farewell, old friend. The empire will remember you, and so will I."}
                [if]
                    [variable]
                        name=STKills
                        greater_than_equal_to=$JMKills
                    [/variable]
                    [then]
                        {TALKWORDY SeptusT JugarthusM _"I don't think we're going to get to have that beer right now, Nemidian, but just remember who beat you, alright?"}    
                        {TALKWORDY JugarthusM SeptusT _"Bah. I didn't want your silly little coat anyway!"}    
                    [/then]
                    [else]
                        {TALKWORDY SeptusT JugarthusM _"I've decided that after all that I'm feeling little warm for your coat anyway, Lavinian, but just remember who beat you, alright?"}    
                        {TALKWORDY JugarthusM SeptusT _"Bah. Your horse got half of those for you!"}
                    [/else]
                [/if]
                [store_unit]
                    [filter]
                        id=AldwylfW
                    [/filter]
                    variable=chaser
                [/store_unit]
                [endlevel]
                    result=victory
                    bonus=yes
                    {NEW_GOLD_CARRYOVER 40}
                [/endlevel]
            [/else]
        [/if]
    [/event]

    # If you kill Ranwlyf, then that's nice for you, but the scenario goes on. Hopefully Aldwylf will have spawned by this point.
        [event]
        name=last breath
        [filter]
            id=RanwylfC
        [/filter]
        {TALK RanwylfC _"I did not expect to die today. But it is no matter...your city will fall sooner or later, Lavinian."}
    [/event]
    
    # If you somehow kill all enemy units (once they've all spawned) you win!
    # Also, you need to play on a higher difficulty, please
    [event]
        name=enemies defeated
        [filter_condition]
            [variable]
                name=turns
                greater_than=12
            [/variable]
        [/filter_condition]
        {TALK CaiusR _"We may have beaten them for now, but we must still evacuate before all Marauderdom falls upon us. Senturus, hold the city as long as you can."}
        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]
    
    # If Senturus dies before the final phase you lose.
    [event]
        name=last breath
        [filter]
            id=SenturusA
        [/filter]
        [filter_condition]
            [variable]
                name=turns
                less_than=12
            [/variable]
        [/filter_condition]
        [message]
            speaker=unit
            message= _ "My mission...is not...over..."
        [/message]
    [/event]
    [event]
        name=last breath
        [filter]
            id=SenturusA
        [/filter]
        [filter_condition]
            [variable]
                name=turns
                greater_than=11
            [/variable]
        [/filter_condition]
        [message]
            speaker=unit
            message= _ "I die, but the 12th Legion will go on!"
        [/message]
    [/event]
    [event]
        name=die
        [filter]
            id=SenturusA
        [/filter]
        [filter_condition]
            [variable]
                name=turns
                less_than=12
            [/variable]
            [/filter_condition]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    
    # If a nobleman dies you lose.
    [event]
        name=last breath
        [filter]
            type=IE_Lavinian_Nobleman
        [/filter]
        [message]
            speaker=unit
            message= _ "I was promised...protection..."
        [/message]
    [/event]
    [event]
        name=die
        [filter]
            type=IE_Lavinian_Nobleman
        [/filter]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    # If the Marauders take a village in the city before the final phase you lose.
    [event]
        name=moveto
        [filter]
          side=4,5
            [filter_location]
                x=10,11,13,16,17,19,20
                y=26,25,28,27,24,26,24
            [/filter_location]
        [/filter]
        [filter_condition]
            [variable]
                name=turns
                less_than=12
            [/variable]
        [/filter_condition]
        [message]
            speaker=unit
            message= _ "Plunder!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    # If you run out of time you lose
    [event]
        name=time over
        {TALK CaiusR _"We cannot afford to waste so much time. Our enemies are closing in and now there can be no escape!"}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
   
    # septus and jugarthus have a bet going.
    [event]
        name=die
        [filter_second]
            id=JugarthusM
        [/filter_second]
        [set_variable]
            name=JMKills
            add=1
        [/set_variable]
    [/event]
    [event]
        name=die
        [filter_second]
            id=SeptusT
        [/filter_second]
        [set_variable]
            name=STKills
            add=1
        [/set_variable]
    [/event]
	

    # victory event clears variables 
    [event]
        name=victory
        [clear_variable]
            name=turns
        [/clear_variable]
        [clear_variable]
            name=STkills
        [/clear_variable]
        [clear_variable]
            name=JMkills
        [/clear_variable]
        [clear_variable]
            name=rando
        [/clear_variable]
        [clear_variable]
            name=civescape
        [/clear_variable]
    [/event]
    
[/scenario]